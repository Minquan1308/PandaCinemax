@model List<DoAnCoSoTL.Models.Room>
@{
    Layout = "_AdminLayout";
    var errorMessage = TempData["ErrorMessage"] as string;
}

<div class="container mt-5">
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger" role="alert">
            @errorMessage
        </div>
    }
    <div class="container mt-5">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">Mã phòng</th>
                    <th scope="col">Số ghế</th>
                    <th scope="col">Rạp</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var room in Model)
                {
                    var tich = room.soHang * room.soCot;
                    <tr>
                        <th scope="row">@room.Id</th>
                        <td>@tich</td>
                        <td>@room.Cinema?.Name</td>
                        <td>
                            <a href="#" class="btn-delete" data-id="@room.Id"><i class="ti-trash"></i></a>
                            <a asp-action="RoomDetails" asp-route-id="@room.Id"><i class="fa fa-arrow-circle-right"></i></a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        @if (Model.Count == 0)
        {
            <img src="/images/error/notfound.png" style="height:50vh; text-align:center; margin-left:30%;" />
            <a asp-action="AddRoom" class="btn btn-warning font-weight-bold" style="color: white; width:70px; height:70px; border-radius:50%; text-align:center; padding: 2.5% 0;"> Add <i class="fa fa-plus-circle"></i></a>
        }
        else
        {
            <a asp-action="AddRoom" class="btn btn-primary"> Add <i class="fa fa-plus-circle"></i></a>
        }
        <form id="delete-form" action="@Url.Action("RoomDelete", "Cinema")" method="post" style="display: none;">
            <input type="hidden" name="id" value="" />
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.btn-delete').click(function (e) {
                e.preventDefault();
                var deleteId = $(this).data('id');
                if (confirm("Are you sure to delete this room?")) {
                    $.post('/Admin/Cinema/RoomDelete/' + deleteId)
                        .done(function (response) {
                            if (response.success) {
                                console.log("Room successfully deleted");
                                window.location.reload();
                            } else {
                                alert(response.message);
                            }
                        })
                        .fail(function (error) {
                            console.error("This screening room has been booked and cannot be deleted ", error);
                            alert("This screening room has been booked and cannot be deleted .");
                        });
                }
            });
        });
    </script>
}


