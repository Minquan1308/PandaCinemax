@model List<DoAnCoSoTL.Models.DetailWithMovieInfoModel>
@inject MovieContext dbContext

@{
    DateTime specificDate = new DateTime(2024, 4, 18);
    DateTime currentDate = DateTime.Today.Date;
    List<DateTime> dateList = new List<DateTime>();
    DateTime dateIterator = specificDate;
    while (dateIterator <= currentDate)
    {
        dateList.Add(dateIterator);
        dateIterator = dateIterator.AddDays(1);
    }
}
@{
    decimal Total = ViewBag.Total ?? 0;
    decimal MonthlyRevenueUpToSelectedDate = ViewBag.MonthlyRevenueUpToSelectedDate ?? 0;
    decimal TotalMonthlyRevenue = ViewBag.TotalMonthlyRevenue ?? 0;
}

<div class="date-picker mb-4">
    <div class="form-inline">
        <label for="dateSelector" class="mr-2">Choose Date:</label>
        <select class="form-control" id="dateSelector" onchange="filterByDate()">
            @foreach (var date in dateList)
            {
                <option value="@date.ToString("yyyy-MM-dd")">@date.ToShortDateString()</option>
            }
        </select>
    </div>
</div>

<div class="container">
    <h2 class="text-center mt-5 mb-3">Daily Revenue</h2>

    @if (Model.Any())
    {
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">OrderId</th>
                    <th scope="col">CustomerId</th>
                    <th scope="col">OrderDate</th>
                    <th scope="col">Movie</th>
                    <th scope="col">TotalPrice</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr>
                        <td>@order.OrderId</td>
                        <td>@order.UserId</td>
                        <td>@order.OrderDate</td>
                        <td>@order.MovieName</td>
                        <td>@order.Price</td>
                        <td>
                            <a href="@Url.Action("Details", "Screening", new { area = "Employee", orderId = order.OrderId })" class="btn btn-info btn-sm"><i class="fa fa-arrow-circle-right"></i></a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="summary-info">
            <p>Total Amount: @Total</p>
            <p>Cash: @ViewBag.COD</p>
            <p>VNPay: @ViewBag.VNPay</p>
            <p>Monthly Revenue Up To Selected Date: @MonthlyRevenueUpToSelectedDate</p>
            <p>Total Monthly Revenue: @TotalMonthlyRevenue</p>
        </div>
    }
    else
    {
        <p class="text-center">There are currently no orders for the day.</p>
        <div class="summary-info">
            <p>Total Amount: @Total</p>
            <p>COD: @ViewBag.COD</p>
            <p>VNPay: @ViewBag.VNPay</p>
            <p>Monthly Revenue Up To Selected Date: @MonthlyRevenueUpToSelectedDate</p>
            <p>Total Monthly Revenue: @TotalMonthlyRevenue</p>
        </div>
    }
</div>

<script>
    function filterByDate() {
        var selectedDate = document.getElementById("dateSelector").value;
        window.location.href = "/Employee/Screening/DailyRevenue?date=" + selectedDate;
    }

    window.onload = function () {
        var dateSelector = document.getElementById("dateSelector");
        var selectedDate = "@ViewBag.SelectedDate";
        if (selectedDate) {
            dateSelector.value = selectedDate;
        }
    };
</script>

<style>
    .date-picker {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .summary-info {
        display: flex;
        flex-direction: column;
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

        .summary-info p {
            margin: 0;
            font-weight: bold;
        }

    .form-inline {
        display: flex;
        align-items: center;
    }

        .form-inline label {
            margin-right: 10px;
        }

        .form-inline .form-control {
            width: auto;
        }

    .table {
        margin-top: 20px;
    }

        .table thead {
            background-color: #343a40;
            color: white;
        }
</style>